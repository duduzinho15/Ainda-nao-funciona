#!/usr/bin/env python3
"""
Script simples para Windows - Executa em primeiro plano para diagn√≥stico
"""

import sys
from pathlib import Path

# Adiciona o diret√≥rio raiz ao path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))


def main():
    """Fun√ß√£o principal"""
    print("üöÄ INICIANDO DASHBOARD GARIMPEIRO GEEK")
    print("=" * 50)

    try:
        # Importa o app
        from app import app

        print("‚úÖ App importado com sucesso")

        # Verifica banco de dados
        try:
            db_path = project_root / "ofertas.db"
            if db_path.exists():
                import sqlite3

                conn = sqlite3.connect(str(db_path))
                cursor = conn.cursor()
                cursor.execute("SELECT COUNT(*) FROM ofertas")
                count = cursor.fetchone()[0]
                conn.close()
                print(f"‚úÖ Banco de dados: {count} ofertas")
            else:
                print("‚ö†Ô∏è Banco de dados n√£o encontrado")
        except Exception as e:
            print(f"‚ö†Ô∏è Erro no banco: {e}")

        print("\nüîß Iniciando servidor...")
        print("üí° Se n√£o funcionar, tente executar como administrador")
        print("üí° Ou desative temporariamente o Windows Defender")

        # Configura√ß√µes espec√≠ficas para Windows
        app.config["ENV"] = "production"
        app.config["DEBUG"] = False
        app.config["TESTING"] = False

        # Tenta porta 8080 (menos restritiva)
        print("\nüîÑ Tentando porta 8080...")
        print("üåê Acesse: http://127.0.0.1:8080")

        app.run(
            host="127.0.0.1", port=8080, debug=False, use_reloader=False, threaded=True
        )

    except Exception as e:
        print(f"\n‚ùå Erro: {e}")
        print("\nüí° SOLU√á√ïES PARA WINDOWS:")
        print("   1. Execute como administrador")
        print("   2. Desative temporariamente o Windows Defender")
        print("   3. Verifique configura√ß√µes de firewall")
        print("   4. Use uma porta diferente")
        print("   5. Verifique se o antiv√≠rus est√° bloqueando")


if __name__ == "__main__":
    main()
