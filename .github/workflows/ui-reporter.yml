name: UI Reporter
on: [push, pull_request]

jobs:
  ui-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: Run UI Reporter
        run: |
          python -m app.dashboard --report --json --strict --exit-after-report > ui_summary.json
          
      - name: Verify snapshot baseline
        run: |
          python diagnostics/verify_snapshot.py
          
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ui-reporter-artifacts
          path: |
            ui_snapshot.txt
            ui_summary.json
          retention-days: 30
          
      - name: Show summary
        if: always()
        run: |
          echo "=== UI Reporter Summary ==="
          if [ -f ui_summary.json ]; then
            echo "‚úÖ UI Reporter executado com sucesso"
            echo "üìä Checks realizados:"
            python -c "import json; data=json.load(open('ui_summary.json')); [print(f'  {k}: {\"‚úÖ\" if v else \"‚ùå\"}') for k,v in data['checks'].items()]"
          else
            echo "‚ùå UI Reporter falhou"
            exit 1
          fi
